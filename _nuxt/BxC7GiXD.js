import{u as p,a as y}from"./Bpf_WSIJ.js";import{e as g,f as t,S as c,T as R,U as v,V as U,z as b,W as w,c as _,X as d}from"#entry";const x=()=>{const{$auth:f,$db:u}=g(),{user:s}=p(),l=t("fb_role",()=>"user"),a=t("fb_profile",()=>null),o=t("fb_role_loading",()=>!1),n=async()=>{if(!s.value)return l.value="user",o.value=!1,"user";try{o.value=!0;const e=c(u,"users",s.value.uid),r=await v(e);l.value=r.exists()?r.data().role:"user"}catch{l.value="user"}finally{o.value=!1}return l.value},i=async()=>{if(a.value={email:"",role:"user",name:"",phone:"",address:{delivery:"",invoice:""}},s.value)try{const e=c(u,"users",s.value.uid),r=await v(e);r.exists()?a.value=r.data():(a.value={email:s.value.email,role:"user",name:"",phone:"",address:{delivery:"",invoice:""}},await U(e,a.value))}catch(e){console.error("Error fetching profile:",e)}return a.value};function m(e,r){return{email:r.email??e.email,role:r.role??e.role,name:r.name??e.name,phone:r.phone??e.phone,address:{delivery:r.address?.delivery??e.address.delivery,invoice:r.address?.invoice??e.address.invoice}}}async function h(e){if(!s.value)return!1;try{const r=c(u,"users",s.value.uid);if(await R(r,{...e}),a.value)return a.value=m(a.value,e),!0}catch{return!1}return!1}return{userProfile:a,userRoleStatus:o,getUserRole:n,getUserProfile:i,updateUserProfile:h}},P=()=>{const{authUser:f}=y(),{getUserRole:u}=x(),s=t("user_role",()=>"user"),l=t("role_loading",()=>!1);let a=null;a=b(f,async n=>{if(n){l.value=!0;const i=await u();s.value=i,l.value=!1}else s.value="user"},{immediate:!0}),w(()=>{a&&a()});const o=_(()=>s.value==="admin");return{role:d(s),isRoleLoading:d(l),isAdmin:o}};export{P as a,x as u};
