import{f as i,e as U,c as S,X as y,Y as m,Z as b,W as p,z as L,$ as I,a0 as F,a1 as O,V as _,S as z,M as C}from"#entry";const E=()=>{const a=i("fb_user",()=>null),n=i("fb_auth_initialized",()=>!1),o=i("fb_auth_loading",()=>!0),{$auth:u,$db:g}=U(),l=()=>{if(n.value)return;const e=m(u,t=>{a.value=t,n.value=!0,o.value=!1},t=>{n.value=!0,o.value=!1});b()?p(()=>{console.log("ðŸ§¹ Auth listener unmounted"),e()}):window.addEventListener("beforeunload",()=>e())};n.value||l();const c=async(e,t,s)=>{try{const r=await O(u,e,t);if(r){a.value=r.user;const A=!s||s.trim()===""?e.split("@")[0]:s.trim();return await _(z(g,"users",r.user.uid),{email:e,role:"user",name:A,phone:"",address:{delivery:"",invoice:""},createdAt:new Date().toISOString()}),!0}}catch{return!1}return!1},d=async(e,t)=>{try{const s=await F(u,e,t);if(s)return a.value=s.user,!0}catch{return!1}return!1},f=async()=>{try{return await I(u),a.value=null,!0}catch{return!1}},h=S(()=>a.value!==null),v=S(()=>a.value?.uid??null),w=()=>new Promise(e=>{if(n.value||l(),n.value){e(a.value);return}const t=L(n,s=>{s&&(t(),e(a.value))});setTimeout(()=>{n.value||(t(),e(a.value))},5e3)});return{user:y(a),initialized:y(n),isLoading:y(o),isAuthenticated:h,userId:v,registerUser:c,signInUser:d,signOutUser:f,waitForAuth:w}},W=()=>{const{user:a,isLoading:n,isAuthenticated:o,registerUser:u,signInUser:g,signOutUser:l}=E(),c=i("authUser",()=>null),d=i("authStatus",()=>!1),f=i("loadingStatus",()=>!1);C(()=>{d.value=o.value,f.value=n.value,c.value=a.value});async function h(e,t){const s=await g(e,t);console.log(s?"Successfully signed in.....":"Failed to sign in.....")}async function v(e,t,s){const r=await u(e,t,s);console.log(r?"Successfully registered.....":"Failed to register.....")}async function w(){const e=await l();console.log(e?"Signed out successfully.....":"Failed to sign out.....")}return{authUser:c,authStatus:d,loadingStatus:f,handleLogin:h,handleRegistration:v,handleLogout:w}};export{W as a,E as u};
